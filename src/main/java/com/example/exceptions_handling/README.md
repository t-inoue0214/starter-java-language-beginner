# 第4章: 失敗したときの保険（例外処理）

プログラムは完璧ではありません。

「割り算で0で割ってしまった」「数字だと思って読んだら文字だった」といった想定外の事態（例外）が起きることがあります。

何もしないと、プログラムはそこで **強制終了（クラッシュ）** してしまいます。

これを防ぎ、「エラーは起きたけど、処理を止めずに報告だけして次へ進む」ための仕組みが **例外処理** です。

## 1. 例外処理の基本構文 (try-catch)

```java
try {
    // 1. 危険なことに挑戦するエリア
    // ここでエラーが起きると、即座に catch へ飛びます。
} catch (Exception e) {
    // 2. 失敗したときのフォローをするエリア
    // 「エラーが起きました！」と表示するなど。
} finally {
    // 3. 最後に必ずやるエリア（省略可能）
    // 成功しても失敗しても、必ず実行されます（後片付けなど）。
}
```

イメージは **「ゲームオーバー画面にならずに、コンティニュー画面を出す」** 仕組みです。

## 2. あの「赤い文字」は何？ (スタックトレース)

エラーが起きるとコンソールに出る大量の赤い文字。

あれは呪いの言葉ではなく、 **「犯行現場の地図」** です。

何が起きたか: `java.lang.NullPointerException` などの例外名。

どこで起きたか: `at com.example...Main.java:15` のような行番号。

スタックトレースは、上から順番に過去の呼び出し箇所が記録されています。

つまり、 **一番上の行** （または Caused by と書かれた行）と、その後の **過去の呼び出し箇所** のうち、自身が作成したクラスのクラスメイト行番号を見つけることができたら **原因の9割は特定** できます。

怖がらずに読みましょう。

## 3. 2種類の例外

Javaの例外には、扱いが違う2つのグループがあります。

### チェック例外 (Checked Exception)

+ 「備えあれば憂いなし」例外。
+ ファイル読み込みや通信など、「失敗する可能性が高い処理」で起きます。
+ プログラムを書く時点で try-catch を書かないと、コンパイルエラー（そもそも実行すらさせてくれない）になります。

### 非チェック例外 (Unchecked Exception / RuntimeException)

+ 「不注意」例外。
+ 0での割り算や、nullの操作など、「プログラマーのミス」で起きるものです。
+ 基本的には try-catch するよりも、バグとしてコードを直すべきものです。
