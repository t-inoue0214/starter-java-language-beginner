# 第5章: コレクションを使いこなす（Mapの種類と罠）

Mapは「キーと値」で管理する便利な道具ですが、種類ごとの特徴を知らないとシステムの性能を落とす原因になります。

現場で使われる代表的な4つのMapと、その選び方を学びます。

## 1. Mapの「上書き」ルール

全てのMapに共通する絶対のルールです。

* **「同じキー」を入れると、値は上書きされます。**
* エラーにはならず、しれっと古いデータが消えます。これを理解して使いましょう。

## 2. Mapの四天王（使い分け基準）

| クラス名 | 特徴・用途 | 注意点 |
| :--- | :--- | :--- |
| **HashMap** | **【基本】** 順序バラバラだが**最速**。 | 特になければこれを使う。 |
| **LinkedHashMap** | **【順序維持】** 「入れた順」または「アクセスした順」を記憶する。 | LRUキャッシュ（最近使ったものを残す仕組み）として利用可能。 |
| **TreeMap** | **【ソート】** キーの名前順（辞書順）で常に自動整列される。 | **重い。** 毎回並び替え処理が走るため、必要ないなら使わないこと。 |
| **ConcurrentHashMap** | **【安全】** マルチスレッド（複数の処理が同時に動く）環境でも壊れない。 | 複数の人が同時に書き込んでも安全なHashMap。 |

## 3. ループ処理の鉄板 (Entry)

Mapの中身を全部見る場合、キーだけ取り出して後から値を引くのは二度手間（非効率）です。

**`Map.Entry`（エントリー）** を使うと、「キーと値のペア」をセットで取り出せるため、最も効率よくループできます。

## 4. ソート（並べ替え）

データはいつも決まった順序とは限りません。

「年齢順」「名前順」など、自分の好きなルールで並べ替える方法を学びます。

* **Comparator (コンパレータ):** 「どっちが偉いか」を決める審判員のこと。

## 5. 【最重要】コピーの罠（シャローコピー）

リストをコピーするとき、一番怖いのがこの現象です。

* **やりたいこと:** ノートをコピーして、コピーの方だけに落書きしたい。
* **実際の動き (シャローコピー):** 「ノートのコピー」ではなく、「ノートの置き場所を書いたメモ」がコピーされるだけ。
* **結果:** メモを頼りにノートに落書きすると、**原本のノートにも落書きされてしまう！**

この「参照のコピー」という仕組みを理解していないと、データを壊してしまうバグになります。
